<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <title>REMUS RLF Explorer</title>
  <link rel="stylesheet" href="style.css?v=4">
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js" charset="utf-8"></script>
</head>
<body>
  <!-- Landing view: header + upload -->
  <div id="landing">
    <header>
      <h1>REMUS RLF Explorer</h1>
      <p class="subtitle">Client-side AUV Run Log File viewer &mdash; powered by Pyodide</p>
      <p class="subtitle" style="font-size:0.75rem;color:#999;" id="build-info">Build: ...</p>
      <p class="privacy-note">Your data stays private. Files are parsed entirely in your browser using
        <a href="https://pyodide.org/" target="_blank">Pyodide</a> (Python in WebAssembly) and
        <a href="https://plotly.com/javascript/" target="_blank">Plotly.js</a>.
        Nothing is uploaded to any server.</p>
    </header>

    <main class="landing-main">
      <div id="upload-zone" class="upload-zone">
        <div class="upload-content">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
            <polyline points="17 8 12 3 7 8"/>
            <line x1="12" y1="3" x2="12" y2="15"/>
          </svg>
          <p>Drop an <strong>.RLF</strong> file here or click to browse</p>
          <input type="file" id="file-input" accept=".rlf,.RLF" hidden>
        </div>
      </div>

      <div class="preview-section">
        <h2 class="preview-heading">What to expect</h2>
        <div class="preview-grid">
          <figure class="preview-figure">
            <img src="../screenshots/screenshot_1.png" alt="Plots view" class="preview-img">
            <figcaption class="preview-caption">Plots view</figcaption>
          </figure>
          <figure class="preview-figure">
            <img src="../screenshots/screenshot_2.png" alt="Messages view" class="preview-img">
            <figcaption class="preview-caption">Messages view</figcaption>
          </figure>
        </div>
        <div class="preview-video-wrapper">
          <iframe class="preview-video" src="https://www.youtube.com/embed/UNuNsC6M44s" title="REMUS RLF Explorer demo" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
      </div>

      <div id="loading" class="loading hidden">
        <div class="spinner"></div>
        <p id="loading-msg">Loading Python runtime...</p>
      </div>
    </main>
  </div>

  <!-- App view -->
  <div id="app-view" class="app-view hidden">
    <!-- Left sidebar -->
    <aside id="sidebar" class="sidebar">
      <div class="sidebar-header">
        <h2>REMUS RLF Explorer</h2>
        <span class="sidebar-build" id="build-info-app">Build: ...</span>
        <div class="sidebar-label">Tracks</div>
      </div>
      <div class="sidebar-files">
        <table id="quicklook-table" class="quicklook-table">
          <thead><tr><th></th><th>File</th><th>Hrs</th><th></th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="sidebar-minimap" id="sidebar-minimap"></div>
      <div class="sidebar-footer">
        <button id="add-file-btn" class="add-file-btn" title="Add another RLF file">+ Add file</button>
        <input type="file" id="file-input-add" accept=".rlf,.RLF" hidden>
        <div class="sidebar-drop-hint">or drag &amp; drop an .RLF anywhere</div>
      </div>
    </aside>

    <!-- Right pane -->
    <div class="right-pane">
      <!-- Toolbar -->
      <div id="toolbar" class="toolbar">
        <span class="toolbar-file" id="toolbar-file"></span>
        <span class="toolbar-sep">|</span>
        <span class="toolbar-cursor" id="toolbar-cursor">Cursor: --</span>
        <span class="toolbar-sep">|</span>
        <span class="toolbar-zoom" id="toolbar-zoom">Full range</span>
        <button class="toolbar-btn" id="btn-zoom-out" title="Zoom out 50% on all plots">&#8722; Zoom out</button>
        <button class="toolbar-btn" id="btn-reset-zoom" title="Reset zoom on all plots (R)">&#8634; Reset</button>
        <span class="toolbar-spacer"></span>
        <span class="toolbar-keys" title="Keyboard shortcuts">? keys</span>
      </div>

      <!-- Tab bar -->
      <div class="tab-bar">
        <button class="tab-btn active" data-tab="plots">Plots</button>
        <button class="tab-btn" data-tab="messages">Messages</button>
      </div>

      <!-- Loading overlay -->
      <div id="loading-app" class="loading hidden">
        <div class="spinner"></div>
        <p id="loading-msg-app">Parsing...</p>
      </div>

      <!-- Tab: Plots -->
      <div id="tab-plots" class="tab-content">
        <!-- Sticky summary bar -->
        <div id="summary-panel" class="summary-bar hidden">
          <span id="summary-title" class="summary-bar-title"></span>
          <div id="summary-content" class="summary-bar-items"></div>
        </div>
        <div class="plots-scroll">
          <div class="plot-grid">
            <div id="plot-depth" class="plot-box"></div>
            <div id="plot-temp-sal" class="plot-box"></div>
            <div id="plot-sos" class="plot-box"></div>
            <div id="plot-eco" class="plot-box"></div>
            <div id="plot-attitude" class="plot-box"></div>
            <div id="plot-nav-speed" class="plot-box"></div>
            <div id="plot-record-rate" class="plot-box"></div>
            <div id="plot-dvl" class="plot-box"></div>
          </div>
          <div class="plot-grid secondary">
            <div id="plot-battery" class="plot-box"></div>
            <div id="plot-modem" class="plot-box"></div>
            <div id="plot-track" class="plot-box"></div>
            <div id="plot-sidescan" class="plot-box"></div>
          </div>
        </div>
      </div>

      <!-- Tab: Messages -->
      <div id="tab-messages" class="tab-content hidden">
        <!-- Filter bar -->
        <div class="filter-bar">
          <input type="text" id="msg-search" class="msg-search" placeholder="Search messages...">
          <label class="link-zoom-label" title="Filter messages to visible plot time range">
            <input type="checkbox" id="link-zoom" checked> Link to zoom
          </label>
          <button class="toolbar-btn" id="btn-select-all-types" title="Enable all message type filters">All types</button>
          <button class="toolbar-btn" id="btn-select-no-types" title="Disable all message type filters">No types</button>
          <span id="msg-status" class="msg-status"></span>
        </div>
        <div class="type-chips" id="type-chips"></div>

        <!-- Message list + detail split -->
        <div class="msg-split">
          <div id="msg-scroll" class="msg-scroll">
            <div class="msg-header">
              <span class="msg-col-time">t (hrs)</span>
              <span class="msg-col-utc">UTC</span>
              <span class="msg-col-type">Type</span>
              <span class="msg-col-fields">Fields</span>
            </div>
            <div id="msg-body" style="position:relative;"></div>
          </div>

          <!-- Detail panel -->
          <div id="detail-panel" class="detail-panel hidden">
            <div class="detail-header">
              <span id="detail-title"></span>
              <button class="detail-close" id="detail-close" title="Close (Esc)">&times;</button>
            </div>
            <div class="detail-body">
              <div class="detail-fields" id="detail-fields"></div>
              <div class="detail-context" id="detail-context">
                <div class="detail-context-title">Context (raw stream)</div>
                <div id="detail-context-rows"></div>
              </div>
            </div>
            <details class="detail-hex">
              <summary>Raw Hex</summary>
              <pre id="detail-hex-content"></pre>
            </details>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Keyboard shortcuts modal -->
  <div id="keys-modal" class="modal-overlay hidden">
    <div class="modal-card">
      <h3>Keyboard Shortcuts</h3>
      <table class="keys-table">
        <tr><td><kbd>Esc</kbd></td><td>Unlock cursor / close detail panel</td></tr>
        <tr><td><kbd>&uarr;</kbd> <kbd>&darr;</kbd></td><td>Navigate message list</td></tr>
        <tr><td><kbd>Enter</kbd></td><td>Lock cursor to selected message</td></tr>
        <tr><td><kbd>F</kbd></td><td>Focus search box</td></tr>
        <tr><td><kbd>R</kbd></td><td>Reset zoom on all plots</td></tr>
        <tr><td><kbd>L</kbd></td><td>Toggle &ldquo;Link to zoom&rdquo;</td></tr>
        <tr><td><kbd>1</kbd> <kbd>2</kbd></td><td>Switch tabs (Plots / Messages)</td></tr>
      </table>
      <button class="modal-close" id="keys-modal-close">Close</button>
    </div>
  </div>

  <script src="plots.js?v=4"></script>
  <script src="app.js?v=4"></script>
</body>
</html>
