<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <title>REMUS RLF Explorer</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js" charset="utf-8"></script>
</head>
<body>
  <!-- Landing view: header + upload -->
  <div id="landing">
    <header>
      <h1>REMUS RLF Explorer</h1>
      <p class="subtitle">Client-side AUV Run Log File viewer &mdash; powered by Pyodide</p>
      <p class="subtitle" style="font-size:0.75rem;color:#999;" id="build-info">Build: ...</p>
      <p class="privacy-note">Your data stays private. Files are parsed entirely in your browser using
        <a href="https://pyodide.org/" target="_blank">Pyodide</a> (Python in WebAssembly) and
        <a href="https://plotly.com/javascript/" target="_blank">Plotly.js</a>.
        Nothing is uploaded to any server.</p>
    </header>

    <main class="landing-main">
      <div id="upload-zone" class="upload-zone">
        <div class="upload-content">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
            <polyline points="17 8 12 3 7 8"/>
            <line x1="12" y1="3" x2="12" y2="15"/>
          </svg>
          <p>Drop an <strong>.RLF</strong> file here or click to browse</p>
          <input type="file" id="file-input" accept=".rlf,.RLF" hidden>
        </div>
      </div>

      <div id="loading" class="loading hidden">
        <div class="spinner"></div>
        <p id="loading-msg">Loading Python runtime...</p>
      </div>
    </main>
  </div>

  <!-- App view: two-pane explorer (hidden until first file loads) -->
  <div id="app-view" class="app-view hidden">
    <!-- Left sidebar: file list -->
    <aside id="sidebar" class="sidebar">
      <div class="sidebar-header">
        <h2>REMUS RLF Explorer</h2>
        <span class="sidebar-build" id="build-info-app">Build: ...</span>
        <div class="sidebar-label">Tracks</div>
      </div>
      <div class="sidebar-files">
        <table id="quicklook-table" class="quicklook-table">
          <thead><tr><th></th><th>File</th><th>Hrs</th><th></th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="sidebar-footer">
        <button id="add-file-btn" class="add-file-btn" title="Add another RLF file">+ Add file</button>
        <input type="file" id="file-input-add" accept=".rlf,.RLF" hidden>
      </div>
    </aside>

    <!-- Right pane -->
    <div class="right-pane">
      <!-- Fixed map at top -->
      <div id="quicklook-map" class="quicklook-map"></div>

      <!-- Tab bar -->
      <div class="right-tabs">
        <button class="right-tab active" data-tab="summary">Summary</button>
        <button class="right-tab" data-tab="plots">Plots</button>
        <button class="right-tab" data-tab="messages">Messages</button>
      </div>

      <!-- Scrollable content below map -->
      <div class="right-scroll">
        <div id="loading-app" class="loading hidden">
          <div class="spinner"></div>
          <p id="loading-msg-app">Parsing...</p>
        </div>

        <div id="tab-summary" class="tab-content">
          <div id="summary-panel" class="summary-panel hidden">
            <h2 id="summary-title">Mission Summary</h2>
            <div id="summary-content" class="summary-content"></div>
          </div>
        </div>

        <div id="tab-plots" class="tab-content hidden">
        <div id="plots-container" class="plots-container">
          <h2>Summary Plots</h2>
          <div class="plot-grid">
            <div id="plot-track" class="plot-box"></div>
            <div id="plot-depth" class="plot-box"></div>
            <div id="plot-temp-sal" class="plot-box"></div>
            <div id="plot-sos" class="plot-box"></div>
            <div id="plot-eco" class="plot-box"></div>
            <div id="plot-attitude" class="plot-box"></div>
            <div id="plot-sidescan" class="plot-box"></div>
            <div id="plot-nav-speed" class="plot-box"></div>
          </div>

          <h2>Data Quality</h2>
          <div class="plot-grid quality">
            <div id="plot-record-rate" class="plot-box wide"></div>
            <div id="plot-dvl" class="plot-box wide"></div>
            <div id="plot-battery" class="plot-box wide"></div>
            <div id="plot-modem" class="plot-box wide"></div>
          </div>
        </div>
        </div>

        <div id="tab-messages" class="tab-content hidden">
          <div class="messages-toolbar">
            <select id="msg-type-filter"><option value="">All types</option></select>
            <span id="msg-status" class="msg-status"></span>
          </div>
          <div id="msg-scroll" class="msg-scroll">
            <div class="msg-header">
              <span class="msg-col-time">Time (hrs)</span>
              <span class="msg-col-type">Type</span>
              <span class="msg-col-fields">Fields</span>
            </div>
            <div id="msg-body" style="position:relative;"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="plots.js"></script>
  <script src="app.js"></script>
</body>
</html>
