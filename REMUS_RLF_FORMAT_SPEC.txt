================================================================================
  REMUS RLF (Run Log File) Binary Format Specification
  Empirically Derived from REMUS-100 AUV Mission Data
================================================================================

  Vehicle:   REMUS-100 "Aukai" (SN 256, Hydroid Inc.)
  Dataset:   Makua Beach, O'ahu, Hawaii — Sep 6-8, 2013
  Source:    doi:10.6075/J09P3042 (UCSD Library Digital Collections)
  Reference: Amador et al. (2020), JGR Oceans, 10.1029/2020JC016264
  Parser:    remus_rlf.py (companion Python module)

  DISCLAIMER: All field offsets, scaling factors, and physical interpretations
  were derived empirically by binary pattern analysis. No official Hydroid or
  Kongsberg documentation was used. Decoded values should be verified against
  independent measurements before use in analysis.


1. FILE STRUCTURE
================================================================================

An RLF file is a flat sequence of variable-length binary records. There is no
file header or footer. Records are packed back-to-back with no padding.

Each record begins with an 8-byte header:

    Offset  Size  Type        Field
    ------  ----  ----------  ------------------------------------------
    0       2     uint8[2]    Magic bytes: 0xEB 0x90
    2       2     uint16 LE   Checksum
    4       2     uint16 LE   Record type identifier
    6       2     uint16 LE   Payload length in bytes (N)
    8       N     raw bytes   Payload data (sensor-specific structure)

All multi-byte integers and floats are little-endian (LE).

To scan the file, search for the 0xEB90 magic, read the header, extract N
payload bytes, then advance to the next record at offset + 8 + N.

Typical file sizes: 30-35 MB per ~5-hour mission, containing 600K-640K
total records across all types.


2. TIMESTAMP FORMAT
================================================================================

Most record payloads contain a uint32 timestamp at payload byte offset 16.

  Encoding:
    - Lower 31 bits: milliseconds since midnight UTC
    - Bit 31 (MSB): flag bit (purpose not fully determined; mask with
      0x7FFFFFFF to extract the time value)

  Midnight rollover:
    Missions spanning midnight UTC show a large negative jump (~86,400,000 ms)
    in the timestamp sequence. To reconstruct continuous time, detect jumps
    where delta < -1,000,000 ms and add 86,400,000 ms to all subsequent
    values.

  Sample rates:
    Navigation / YSI CTD:  ~18 Hz  (~55 ms between records)
    Wetlabs ECO:           ~1 Hz
    ADCP/DVL:              ~0.67 Hz original, ~0.35 Hz in RLF
    Seabird CTD:           ~0.3 Hz
    Sidescan:              ~1.3 Hz (uses different timing; see Section 4.5)

  Note: The Acoustic Nav Fix record (0x041f) uses a different timestamp
  encoding — a 6-byte wall-clock UTC timestamp (YY/MM/DD/HH/MM/SS) stored
  at payload offsets 46-51. See Section 4.10.


3. RECORD TYPE SUMMARY
================================================================================

  HIGH-RATE SENSOR DATA
  Type     Dec   Name                   Bytes  Rate       Records/Mission
  ------   ----  --------------------   -----  ---------  ---------------
  0x044e   1102  Navigation              46    ~18 Hz     ~247K-294K
  0x041d   1053  YSI CTD                 40    ~18 Hz     ~232K-276K
  0x03f7   1015  Sidescan Metadata       55    ~1.3 Hz    ~17K-20K
  0x03e8   1000  ADCP/DVL               155    ~0.35 Hz   ~15K-17K
  0x043e   1086  Wetlabs ECO BB2F        57    ~1 Hz      ~13K-16K
  0x040a   1034  Seabird CTD (SBE49)     32    ~0.3 Hz    ~3.6K-4.3K
  0x03f9   1017  GPS / Acoustic Nav      59    varies     ~2.8K-3.3K
  0x0424   1060  Acoustic Modem Log      36    ~0.16 Hz   ~2.2K-2.4K
  0x041a   1050  Nav/Acoustic            57    ~0.15 Hz   ~1.9K-2.1K
  0x041f   1055  Acoustic Nav Fix       126    ~1/4 min   ~114/day
  0x0412   1042  Battery Status         139    ~1/8 min   ~40/day
  0x0413   1043  Battery Cell Data       52    ~1/8 min   ~40/day

  MISSION AND CONFIGURATION (low frequency, logged at startup)
  Type     Dec   Name                   Bytes  Records/Mission
  ------   ----  --------------------   -----  ---------------
  0x03f4   1012  Vehicle Name            35    10
  0x040d   1037  Vehicle Info            31    ~198
  0x0416   1046  Manufacturer Info      108    10
  0x03ee   1006  Mission Modes           21    ~200
  0x03f0   1008  Mission Legs            48    ~60
  0x0427   1063  Waypoints               31    ~50
  0x03fc   1020  Sensor Names            13    ~90
  0x0407   1031  Sensor Types            23    ~150
  0x040c   1036  Sensor Display Config   28    10
  0x041c   1052  Data Channels           24    ~260
  0x043d   1085  ECO Calibration         46    ~80

  MISSION CONTROL AND DIAGNOSTICS
  Type     Dec   Name                   Bytes  Rate       Records/Mission
  ------   ----  --------------------   -----  ---------  ---------------
  0x0402   1026  Energy Monitor          13    ~0.05 Hz   ~864
  0x03f1   1009  Objective Navigation    53    ~0.03 Hz   ~454
  0x040e   1038  Housing Temperature     48    ~0.02 Hz   ~267
  0x0415   1045  Compass Calibration     48    ~0.01 Hz   ~198
  0x040b   1035  DVL Status              60    sparse     ~71
  0x0408   1032  Subsystem Mode           6    sparse     ~37
  0x0446   1094  Startup Flag             4    startup    10
  0x03ef   1007  Event Marker             0    sparse     ~9


4. RECORD TYPE FIELD SPECIFICATIONS
================================================================================

All offsets below are relative to the start of the PAYLOAD (after the 8-byte
record header). Field names marked with (?) are tentative assignments.


4.1  Navigation — Type 0x044e (1102), 46 bytes
--------------------------------------------------------------------------------

The highest-rate record, providing vehicle position and flight state at ~18 Hz.

  Offset  Size  Type        Field               Units / Notes
  ------  ----  ----------  ------------------  ----------------------------
  0       8     float64 LE  Latitude            degrees N
  8       8     float64 LE  Longitude           degrees E (negative = W)
  16      4     uint32 LE   Timestamp           ms since midnight UTC
  20      4     float32 LE  Speed               m/s (ground speed)
  24      2     uint16 LE   Alt max range       altimeter max range config (constant 10)
  26      4     float32 LE  Pitch               degrees (confirmed via ADCP cross-validation)
  30      4     float32 LE  Config constant     always 90.0 (altimeter param?)
  34      4     float32 LE  Vehicle depth       m below sea surface
  38      4     float32 LE  Depth duplicate     byte-identical to offset 34
  42      4     float32 LE  Undecoded           float (mean ~-7, range ±23; not pitch/roll/depth)

  Notes:
  - Offset 24: constant 10 in all records across all 4 missions — this is
    the Imagenex 852 altimeter max range config setting, not actual altitude.
  - Pitch at offset 26: confirmed by cross-validation with ADCP pitch
    (value range [-18.1, 25.6] and mean -1.76 match ADCP pitch exactly).
  - Offset 42: identity unknown. Mean ~-7, range ±23, does not correlate
    with ADCP pitch, ADCP roll, or depth. Previously mislabeled as "Pitch".
  - Offset 30: constant 90.0 across all records (1 unique value).
  - Offset 38: exact byte-for-byte duplicate of offset 34 in all 292,749
    records tested (max absolute diff = 0.000000).
  - Lat/Lon use float64 (double) precision (~1 cm resolution).
  - Observed ranges: lat 21.50-21.52°N, lon -158.24 to -158.23°W
    (Makua Beach, O'ahu, Hawaii).


4.2  YSI CTD — Type 0x041d (1053), 40 bytes
--------------------------------------------------------------------------------

High-rate CTD data from the onboard YSI sensor.

  Offset  Size  Type        Field               Units / Notes
  ------  ----  ----------  ------------------  ----------------------------
  0       8     float64 LE  Latitude            degrees N
  8       8     float64 LE  Longitude           degrees E
  16      4     uint32 LE   Timestamp           ms since midnight UTC
  20      4     float32 LE  Unknown float       range 0.02-42; median ~4 when
                                                submerged; NOT correlated with
                                                nav depth (r = -0.07)
  24      4     float32 LE  Conductivity        mS/cm
  28      4     float32 LE  Temperature         degrees C
  32      4     float32 LE  Salinity            PSU (Practical Salinity Units)
  36      4     float32 LE  Speed of Sound      m/s

  Typical values (tropical seawater, Makua Beach):
    Conductivity:    ~54-56 mS/cm
    Temperature:     ~25-28 °C
    Salinity:        ~33-37 PSU
    Speed of Sound:  ~1537-1542 m/s

  Verification: Speed of Sound matches UNESCO formula prediction
    (T=27.3°C, S=35.3 PSU → predicted 1540.0 m/s, observed mean 1540.2 m/s).


4.3  Seabird CTD / SBE49 — Type 0x040a (1034), 32 bytes
--------------------------------------------------------------------------------

Lower-rate CTD from the Seabird SBE49 sensor. Uses float32 (not float64)
for position, giving reduced (~10 m) spatial precision.

  Offset  Size  Type        Field               Units / Notes
  ------  ----  ----------  ------------------  ----------------------------
  0       4     float32 LE  Latitude            degrees N (reduced precision)
  4       4     float32 LE  Longitude           degrees E (reduced precision)
  8       4     uint32 LE   Timestamp           ms since midnight UTC
  12      4     float32 LE  Altitude (?)        m above bottom (tentative)
  16      4     float32 LE  Conductivity        mS/cm
  20      4     float32 LE  Temperature         degrees C
  24      4     float32 LE  Salinity            PSU
  28      4     float32 LE  Speed of Sound      m/s

  Notes:
  - Salinity from SBE49 (mean ~34.0 PSU) reads slightly lower than the YSI
    (mean ~35.3 PSU), likely due to different calibration.
  - Speed of Sound: SBE49 mean ~1539 m/s vs YSI mean ~1540 m/s.


4.4  ADCP / DVL — Type 0x03e8 (1000), 155 bytes
--------------------------------------------------------------------------------

Data from the onboard RDI 1200 kHz Doppler Velocity Log, which has upward-
and downward-looking transducers configured to sample water velocities in
1 m bins starting at 1 m above and below the vehicle depth (Amador et al.
2020). DVL native sample rate is ~0.67 Hz; RLF logging rate is ~0.35 Hz.

This record uses non-standard alignment: fields start at byte 1 (after a
single-byte sub-type flag), so float32 fields are at odd offsets.

  Offset  Size  Type        Field               Units / Notes
  ------  ----  ----------  ------------------  ----------------------------
  0       1     uint8       Sub-type flag       Always 0x15 (21 decimal)
  1       4     float32 LE  ADCP parameter 1    ~35-41 (internal; possibly
                                                battery voltage or transducer
                                                temperature)
  5       4     float32 LE  Attitude value 1    degrees (small, ±20°)
  9       4     float32 LE  ADCP parameter 2    ~750-761 (internal)
  13      4     float32 LE  Depth value 1       m (~3 m; related to vehicle
                                                depth or bottom-track depth)
  17      4     float32 LE  Depth value 2       m (~3 m; secondary depth)
  21      4     float32 LE  Config constant     Always 100.0
  25      4     float32 LE  Water temperature   degrees C (from ADCP sensor,
                                                reads ~2°C cooler than CTD)
  29      4     float32 LE  Altitude            m above bottom
  33      4     float32 LE  Vehicle depth       m below sea surface
  37      4     float32 LE  Pitch               degrees
  41      4     float32 LE  Roll                degrees (±10° typical)
  45      4     float32 LE  Attitude value 2    degrees (possibly 2nd pitch
                                                or pitch rate)
  49      4     —           Undecoded
  53      4     float32 LE  Heading             degrees (0-360)
  57      4     float32 LE  Bearing             degrees (0-360, similar to
                                                heading; possibly course
                                                over ground)
  61      6     —           Undecoded
  67      8     float64 LE  Position 1 lat      degrees N
  75      8     float64 LE  Position 1 lon      degrees E
  83      8     float64 LE  Position 2 lat      degrees N
  91      8     float64 LE  Position 2 lon      degrees E
  99      8     float64 LE  Position 3 lat      degrees N
  107     8     float64 LE  Position 3 lon      degrees E
  115     40    —           Tail data           Status bytes, partially
                                                decoded (includes zeros
                                                and small integers)

  Notes:
  - The three embedded lat/lon pairs likely represent the vehicle position
    at different points during an ADCP ensemble (start/middle/end, or
    positions for different beam configurations).
  - The record does NOT contain per-bin velocity data; only summary
    navigation and attitude information is stored in the RLF. Raw ADCP
    ensemble data is in the separate .ADC files.
  - Altitude from the ADCP (offset 29) provides a continuous bottom-range
    measurement, unlike the Imagenex altimeter which saturates at 10 m.
    ADCP altitude range: ~1-7 m when vehicle is in shallow water.


4.5  Sidescan Metadata — Type 0x03f7 (1015), 55 bytes
--------------------------------------------------------------------------------

Navigation and attitude metadata logged at the sidescan sonar's ping rate.
This record does NOT contain actual sonar imagery. The MSTL 900 kHz sidescan
was an Ethernet-connected device (IP 192.168.1.90) that logged full-resolution
imagery to separate storage not included in the RLF. Actual sidescan imagery
would typically be in .son, .jsf, .xtf, or .83P/.83S format files.

  Offset  Size  Type        Field               Units / Notes
  ------  ----  ----------  ------------------  ----------------------------
  0       4     float32 LE  Latitude            degrees N (reduced precision)
  4       4     float32 LE  Longitude           degrees E (reduced precision)
  8       4     float32 LE  Altitude            m above bottom
  12      4     float32 LE  Vehicle depth       m below sea surface
  16      4     float32 LE  Speed / velocity    m/s (~1.7 mean; vehicle speed
                                                or current component)
  20      4     float32 LE  Roll-like           degrees (~0 mean)
  24      4     float32 LE  Pitch-like          degrees (~0 mean)
  28      4     float32 LE  Small value         (partially decoded)
  32      4     float32 LE  Temperature         degrees C (~28)
  36      2     —           Undecoded
  38      4     float32 LE  Heading             degrees (0-360)
  42      13    —           Tail / status       Timing and status bytes

  Sentinel value: -32.768 (float32) marks invalid/unavailable data in the
  altitude, depth, and attitude fields. This value corresponds to 0x8000
  (-32768) as an int16, the standard RDI "bad velocity" marker.


4.6  Wetlabs ECO BB2F — Type 0x043e (1086), 57 bytes
--------------------------------------------------------------------------------

Optical sensor data from the Wetlabs ECO BB2F, measuring backscatter at
470 nm and 650 nm, plus chlorophyll-a fluorescence.

Channel configuration (from 130906.ini):
  Position 1:  Ref470        raw counts
  Position 2:  Lambda470     raw counts
               Beta470       1/m/sr  (LINEAR: scale=2.4E-5, offset=50)
  Position 3:  Ref650        raw counts
  Position 4:  Lambda650     raw counts
               Beta650       1/m/sr  (LINEAR: scale=3.26E-6, offset=100)
  Position 5:  Chlorophyll A ug/L    (LINEAR: scale=0.016, offset=75)
  Position 6:  Thermistor    raw counts

  Offset  Size  Type        Field               Units / Notes
  ------  ----  ----------  ------------------  ----------------------------
  0       8     float64 LE  Latitude            degrees N
  8       8     float64 LE  Longitude           degrees E
  16      4     uint32 LE   Timestamp           ms since midnight UTC
  20      4     float32 LE  Vehicle depth       m below sea surface
  24      1     —           Padding / flag byte
  25      4     float32 LE  Ref470              raw counts (~1000)
  29      4     float32 LE  Lambda470           raw signal counts (~93)
  33      4     float32 LE  Beta470             1/m/sr (derived, ~0.001)
  37      4     float32 LE  Ref650              raw counts (~719)
  41      4     float32 LE  Lambda650           raw signal counts (~160)
  45      4     float32 LE  Beta650             1/m/sr (derived, ~0.0001)
  49      4     float32 LE  Chlorophyll proxy   derived value (~-0.1)
  53      4     float32 LE  Thermistor          raw counts (~526)

  Notes:
  - ECO channels start at offset 25 (1-byte offset from 4-byte alignment),
    indicating a single padding or flag byte at offset 24.
  - LINEAR conversion: physical_value = scale × (raw_counts - offset)
    Example: Beta470 = 2.4E-5 × (Lambda470_counts - 50)
  - Negative chlorophyll values indicate raw counts below the dark offset.


4.7  GPS / Acoustic Nav — Type 0x03f9 (1017), 59 bytes
--------------------------------------------------------------------------------

GPS position fixes and acoustic navigation / modem data.

  Offset  Size  Type        Field               Units / Notes
  ------  ----  ----------  ------------------  ----------------------------
  0       8     float64 LE  Latitude            degrees N
  8       8     float64 LE  Longitude           degrees E
  16      4     uint16[2]   GPS fields          (partially decoded)
  20      ~11   mixed       Nav parameters      (partially decoded)
  31      ~22   ASCII       Transponder data    Contains IDs like "REMUS214",
                                                "REMUS275" and signal quality
                                                bytes (0x64 = 100 = max)
  53      6     —           Tail / status

  Notes:
  - GPS time offset from UTC: -600 minutes (Hawaii Standard Time).
  - Transponder IDs in ASCII suggest this record also carries acoustic
    modem / transponder ranging data alongside GPS fixes.
  - GPS configured at 19200 baud (NMEA 183).


4.8  Acoustic Modem Log — Type 0x0424 (1060), variable length (20–50 bytes)
--------------------------------------------------------------------------------

Logs one acoustic modem communication event per record (~2,200-2,400 records
per mission day). Payload length is variable (observed range: 20–50 bytes)
because the message string length varies. There is NO embedded timestamp field;
this record type carries only the two flag bytes and the message string.

  Offset  Size     Type    Field               Units / Notes
  ------  -------  ------  ------------------  ----------------------------
  0       1        uint8   Flag                Always 0x01 (outgoing) or
                                               0x00 (incoming)
  1       1        uint8   Padding             Always 0x00
  2       variable ASCII   Message string      Null-terminated, format:
                                               {dir}({source}) {counter}:{message}

  Message format:
    dir      : '>' outgoing (modem→vehicle log) or '<' incoming (vehicle→modem)
    source   : sender identifier (e.g. 'VehM', 'Veh')
    counter  : per-record sequence number
    message  : message body (see categories below)

  Observed message categories (across all 3 mission days, ~7000 records):

    Category              Example                          Frequency
    --------------------  -------------------------------  -----------
    Firmware heartbeat    'Rev: AUV13 (0.90.0.39)'        Most common
    Self-query            'Query Self Address (SRC)'       Startup only
    Query response        'Response:SRC is 8'             Startup only
    Cycle / TX            'Cycle init (talk)', 'Tx begin'  Surface comms
    Ranging pings         'Ranger data (automatic ...)'    ~1/4 min
    Data quality          'Data quality: (2) 195'          On receive
    Errors                'Error 13: $ not found'          Occasional

  Timestamp assignment:
    Because no timestamp is embedded, the parser infers mission time by
    scanning the file for the byte offset of each modem record and
    interpolating from the surrounding Navigation record (0x044e) timestamps.
    The resulting t_hrs values are accurate to within a few seconds.


4.9  Nav/Acoustic — Type 0x041a (1050), 57 bytes
--------------------------------------------------------------------------------

Navigation record correlated with acoustic positioning updates. Logged at the
acoustic navigation update rate (~2,100-2,200 records per mission day). Records
with invalid acoustic fixes carry -1.0 sentinels in the float fields and zeros
in the lat/lon fields.

  Offset  Size  Type        Field               Units / Notes
  ------  ----  ----------  ------------------  ----------------------------
  0       8     —           Undecoded           (header bytes)
  8       4     float32 LE  Heading (DVL)       degrees (0-360); -1=invalid
  12      4     float32 LE  Sound speed (DVL)   m/s (DVL-reported); -1=invalid
  16      8     —           Undecoded
  24      8     float64 LE  Latitude            degrees N (0 when invalid)
  32      8     float64 LE  Longitude           degrees E (0 when invalid)
  40      4     float32 LE  Heading (compass)   degrees (0-360)
  44      4     float32 LE  Sound speed (CTD)   m/s (CTD-derived)
  48      9     —           Undecoded           (tail bytes)

  Notes:
  - Two heading fields are present: one from the DVL/ADCP inertial system
    (offset 8) and one from the vehicle compass (offset 40). They agree
    to within a few degrees when valid.
  - Two sound speed fields: DVL-reported (offset 12) and CTD-derived
    (offset 44). The CTD-derived value (~1540 m/s) is more accurate.
  - Sentinel -1.0 in DVL fields indicates no valid acoustic fix was
    available; the vehicle was using dead reckoning instead.


4.10  Acoustic Nav Fix — Type 0x041f (1055), 126 bytes
--------------------------------------------------------------------------------

Full transponder-based position fix computed by the acoustic navigation
system (~114 records per mission day, roughly once every 4 minutes). Contains
both the fix position and a wall-clock UTC timestamp embedded in the payload.

  Offset  Size  Type        Field               Units / Notes
  ------  ----  ----------  ------------------  ----------------------------
  0       8     float64 LE  Latitude            degrees N
  8       8     float64 LE  Longitude           degrees E
  16      4     float32 LE  Vehicle heading     degrees (0-360)
  20      2     uint16 LE   Sequence counter    Monotonically increasing
  22      2     uint16 LE   Active transponders Count of transponders used
  24      2     —           Undecoded
  26      4     float32 LE  Vehicle speed       m/s at fix time
  30      4     float32 LE  Acoustic slant range m to nearest transponder
  34      12    —           Undecoded
  46      1     uint8       Year                2-digit year (add 2000)
  47      1     uint8       Month               1-12
  48      1     uint8       Day                 1-31
  49      1     uint8       Hour                0-23 (UTC)
  50      1     uint8       Minute              0-59
  51      1     uint8       Second              0-59
  52      74    —           Undecoded           (transponder response data?)

  Notes:
  - The UTC wall-clock timestamp at offsets 46-51 is independent of the
    standard ms-since-midnight encoding used by other record types. It was
    confirmed by verifying: byte[46]=13 (2013), byte[47]=9 (Sep),
    byte[48]=6 (day 6 for 130906.RLF).
  - Acoustic ranges observed: 150-500 m (consistent with transponder
    deployment depth and vehicle operating area).
  - The vehicle used LBL (Long Baseline) acoustic navigation; the
    transponders REMUS214 and REMUS275 are referenced in 0x03f9 records.


4.11  Battery Status — Type 0x0412 (1042), 139 bytes
--------------------------------------------------------------------------------

Smart battery management system (BMS) status, one record per battery bank
per logging cycle. The four battery banks cycle round-robin with ID codes
2722, 2723, 2724, and 2899 (~40 records total per mission day, ~10 per bank).

  Offset  Size  Type        Field               Units / Notes
  ------  ----  ----------  ------------------  ----------------------------
  0       2     —           Undecoded           (header bytes)
  2       2     uint16 LE   Battery ID code     Cycles: 2722/2723/2724/2899
  4       4     —           Undecoded
  8       2     uint16 LE   Rated capacity      mAh (constant: 5500)
  10      2     uint16 LE   Design pack voltage mV (constant: 28700)
  12      24    —           Undecoded
  36      2     uint16 LE   Cell voltage        mV (real-time, ~3047-3110)
  38      2     uint16 LE   Pack voltage        mV (real-time, ~25700-27740)
  40      99    mixed       Identity strings    Null-separated ASCII strings:
                                                part_number (e.g. 'RE003')
                                                serial      (e.g. '102455')
                                                chemistry   (e.g. 'LiION')
                                                mfg_date    (e.g. 'Dec  2 2009')
                                                mfg_time    (e.g. '18:02:07')

  Notes:
  - Cell voltage at offset 36 is an average cell voltage (per-cell voltages
    are in the companion Battery Cell Data record, 0x0413).
  - Pack voltage: 9 cells × ~3.08 V = ~27.7 V nominal for LiION.
  - The identity strings (part number, serial, chemistry, manufacturing date)
    are constant across all records for a given battery bank — they identify
    the physical battery, not the measurement cycle.
  - All four batteries share the same serial number '102455', suggesting
    they are a matched set manufactured simultaneously.


4.12  Battery Cell Data — Type 0x0413 (1043), 52 bytes
--------------------------------------------------------------------------------

Companion record to Battery Status (0x0412), logged at the same rate with
the same round-robin cycling through all four battery banks. Contains
individual cell-level voltage readings from the BMS.

  Offset  Size  Type        Field               Units / Notes
  ------  ----  ----------  ------------------  ----------------------------
  0       6     —           Undecoded           (header bytes)
  6       2     uint16 LE   Nominal pack voltage mV (constant: 25000)
  8       2     —           Undecoded
  10      2     uint16 LE   Cell voltage        mV (~3089-3112)
  12      2     uint16 LE   Cumulative energy   mAh equivalent (varies)
  14      2     uint16 LE   Per-cycle energy    mAh (varies)
  16      2     uint16 LE   Rated capacity      mAh (constant: 5500)
  18      2     uint16 LE   Battery ID code     Same cycling as 0x0412
  20      18    —           Undecoded
  38      14    uint16[7]   Cell voltage counts 7 readings, raw counts
                                                (~38700-39200 per cell)

  Notes:
  - The 7 cell voltage readings at offsets 38-51 are raw ADC counts from the
    BMS, not millivolts directly. The scaling factor to convert counts to mV
    has not been determined from this dataset alone.
  - The "cell voltage" at offset 10 (~3089-3112 mV) is consistent with the
    individual LiION cell voltages in the Battery Status record.
  - Records are logged in the same round-robin order as 0x0412; the battery
    ID code at offset 18 matches the ID code at offset 2 in 0x0412.


4.13  Objective Navigation — Type 0x03f1 (1009), 53 bytes
--------------------------------------------------------------------------------

Real-time mission leg progress tracking.  Each record reports the current
from-waypoint and to-waypoint navigation state for the active objective.

  Offset  Size  Type        Field               Units / Notes
  ------  ----  ----------  ------------------  ----------------------------
  0       1     uint8       Leg index           0-45, sequential then cycling
  2       2     uint16 LE   Transit time est.   seconds
  4       2     uint16 LE   Leg distance est.   meters (approximate; 5-15%
                                                larger than haversine)
  6       8     float64 LE  FROM latitude       degrees N
  14      8     float64 LE  FROM longitude      degrees E
  22      8     float64 LE  TO latitude         degrees N
  30      8     float64 LE  TO longitude        degrees E
  38      4     float32 LE  Commanded RPM       1736 or 1929
  42      4     float32 LE  Commanded speed     m/s (typically 0 or 4)
  46      1     uint8       Mission mode index  cross-refs 0x03ee mode table
  48      1     uint8       Objective sub-type
  50      2     uint16 LE   Depth setpoint      dm (e.g. 40 = 4.0 m)
  52      1     uint8       Active flag         0=startup, 1=executing

  Notes:
  - Leg distance at offset 4 is an internal estimate, NOT exact haversine:
    it typically runs 5-15% larger (e.g., 705 m vs 749 m haversine).
  - Mode indices cross-reference the Mission Modes table (0x03ee):
    observed values {11,13,14,15} → {Surface, Compass cal, Navigate,
    Navigate rows}.
  - Bytes 1, 47, 49 are always zero.


4.14  Compass Calibration — Type 0x0415 (1045), 48 bytes
--------------------------------------------------------------------------------

Compass bias measurement data logged during the compass calibration phase.
Reference headings at offset 4 exactly match the .ini compass bias table
entries (254.8°, 95.0°, 275.0°, 185.0°, 5.0°, 74.8° on 130906; 34.7°
replaces 74.8° on 130907).

  Offset  Size  Type        Field               Units / Notes
  ------  ----  ----------  ------------------  ----------------------------
  2       2     uint16 LE   Measurement counter 1-N per heading, resets each
  4       4     float32 LE  Reference heading   degrees (from .ini bias table)
  8       4     float32 LE  Sensor reading #1   range 100-290 (NOT heading;
                                                corr 0.87 with @32; possibly
                                                raw magnetometer)
  12      4     float32 LE  Sensor reading #2   similar to @8
  16      4     float32 LE  Measured heading     degrees (clusters near ref)
  20      4     float32 LE  Corrected heading    degrees (clusters near ref)
  24      4     float32 LE  Heading error #1     bias correction (degrees)
  28      4     float32 LE  Heading error #2     secondary error (degrees)
  32      4     float32 LE  Sensor/motor metric  range 1000-3900
  36      4     float32 LE  Sensor/motor metric  range 88-326 (corr 0.93
                                                with @32)
  40      4     float32 LE  Depth               m (~7-11 during cal)
  44      4     float32 LE  Valid flag           constant 1.0

  Verification:
  Mean heading errors by reference heading match .ini bias corrections:
    Ref 254.8° → mean err -1.05° (ini: -1.0)
    Ref  95.0° → mean err -1.28° (ini: -1.1)
    Ref 275.0° → mean err +0.38° (ini: +0.5)
    Ref 185.0° → mean err +0.07° (ini: +0.3)
    Ref   5.0° → mean err -0.66° (ini: -0.7)
    Ref  74.8° → mean err -2.03° (ini: -1.9)


4.15  Housing Temperature — Type 0x040e (1038), 48 bytes
--------------------------------------------------------------------------------

Electronics housing temperature with a sliding FIFO window of compass
error magnitude history.

  Offset  Size  Type        Field               Units / Notes
  ------  ----  ----------  ------------------  ----------------------------
  0       4     float32 LE  Heading correction  signed, ±16° (compass adj)
  4       4     float32 LE  Bias drift          negative (-0.4 to -5.7)
  8       4     float32 LE  Housing temperature °C (~30°C, stable)
  12      4     float32 LE  Newest FIFO entry   compass error magnitude
  16-44   32    float32[8]  FIFO history        right-shifting window

  Notes:
  - Housing temperature stable at ~30°C across all four RLF files
    (130906, 130907, 130907R, 130908).
  - FIFO right-shift verified across all files: 266/266 on 130906,
    360/361 on 130907, 62/62 on 130907R, 329/329 on 130908.  New values
    enter at offset 12 and shift right through 16→20→24→...→44.


4.16  Energy Monitor — Type 0x0402 (1026), 13 bytes
--------------------------------------------------------------------------------

Battery energy consumption tracking at ~0.05 Hz (~864 records/mission).

  Offset  Size  Type        Field               Units / Notes
  ------  ----  ----------  ------------------  ----------------------------
  0       1     uint8       Constant            always 7
  1       4     float32 LE  Capacity            Wh (see notes)
  5       4     float32 LE  Energy metric       Wh (see notes)
  9       4     float32 LE  Status metric       varies (see notes)

  Notes:
  - The capacity field likely represents total available capacity of N
    active battery packs at ~309 Wh each:
      1235.86 / 4 = 309.0 Wh/pack
       930.69 / 3 = 310.2 Wh/pack
       613.14 / 2 = 306.6 Wh/pack
    (verified across 130906, 130907, 130908).
  - On 130906: all 4 packs remained active (capacity constant 1235.86),
    energy monotonically increasing 276→1010 Wh.
  - On 130907/130908: packs dropped out mid-mission, causing capacity
    drops and energy resets.


4.17  DVL Status — Type 0x040b (1035), 60 bytes
--------------------------------------------------------------------------------

ADCP/DVL subsystem internal status/diagnostics.  ~71 records per mission.
First 22 bytes are mostly zeros (byte 11 = constant 8).  Active region at
bytes 23-50 with structured status data.  Internal format not fully
determined; logged as raw hex.


4.18  Subsystem Mode — Type 0x0408 (1032), 6 bytes
--------------------------------------------------------------------------------

Sparse mode/status flag register.  ~37 records per mission.  Only two
patterns observed on 130906:
  04 b0 80 82 05 00  — active mode (27 occurrences)
  04 a0 80 00 00 00  — idle/startup mode (10 occurrences)


4.19  Startup Flag — Type 0x0446 (1094), 4 bytes
--------------------------------------------------------------------------------

Constant payload: 01 00 00 00.  Logged exactly 10 times per mission, the
same count as Vehicle Name records.  Startup/initialization marker.


4.20  Event Marker — Type 0x03ef (1007), 0 bytes
--------------------------------------------------------------------------------

Empty payload (~9 records per mission).  Phase transition or heartbeat
marker.  No fields to decode.


5. SENSOR CROSS-REFERENCE
================================================================================

From the vehicle configuration file (130906.ini):

  Sensor                    Config Setting              In RLF?
  ----------------------    -------------------------   -------
  YSI CTD                   Present=Yes                 Yes (0x041d)
  Seabird CTD (SBE49)       Present=YES                 Yes (0x040a)
  ADCP/DVL (RDI 1200 kHz)   Present=YES                 Yes (0x03e8)
  MSTL Sidescan (900 kHz)   Present=Yes, 192.168.1.90   Metadata only (0x03f7)
  Imagenex 852 Altimeter    Present=YES, max 10 m       Via nav record (0x044e)
  Wetlabs ECO BB2F          Present=YES                 Yes (0x043e)
  NMEA 183 GPS              Present=YES                 Yes (0x03f9)
  Compass + Gyro            Present=Yes                 Via ADCP heading (0x03e8)
  Acoustic Modem            Present=YES                 Yes (0x0424, 0x041a, 0x041f)
  DI Depth Sensor           Offset=-9.025 m             Via nav record (0x044e)
  Motors / Thrusters        Present=Yes                 Diagnostic log (0x03e9)
  Smart Batteries (4×)      LiION, 5500 mAh, 300 Wh    Yes (0x0412, 0x0413)


6. PHYSICAL VALIDATION
================================================================================

Decoded values were verified against:

  1. Published literature (Amador et al. 2020):
     - Vehicle at constant 3 m depth ✓ (nav depth mean ~2.1 m, ADCP ~3.4 m)
     - Cruising at 2 m/s ✓
     - Water depths 5-30 m ✓ (ADCP altitude + depth)
     - Surveys Sep 6-8, 2013 ✓

  2. UCSD dataset readme:
     - Location: Makua Beach, O'ahu ✓ (21.52°N, 158.23°W)
     - Variables: lat, lon, altitude, depth, yaw, pitch, roll ✓

  3. UNESCO speed of sound formula:
     - At T=27.3°C, S=35.3 PSU → predicted 1540.0 m/s
     - YSI CTD observed mean: 1540.2 m/s ✓

  4. Vehicle config (130906.ini):
     - Imagenex 852 max range = 10 m → nav altitude saturates at 10 ✓
     - YSI + Seabird CTD both present → two CTD record types ✓
     - Wetlabs ECO channel definitions match decoded counts ✓
     - UTC offset -600 min (HST) ✓

  5. Battery chemistry verification:
     - LiION nominal cell voltage: 3.0-4.2 V; observed 3.047-3.110 V ✓
     - 9-cell pack @ ~3.08 V/cell → 27.7 V pack; observed 25.7-27.7 V ✓

  6. Acoustic Nav Fix timestamp:
     - Byte[46]=13 → year 2013, byte[47]=9 → September, byte[48]=6 → day 6 ✓
     - Fix times match expected survey schedule ✓


7. KNOWN LIMITATIONS
================================================================================

  - ADCP record (0x03e8): ~40 bytes in the header region (offsets 1-66) and
    40 bytes in the tail (offsets 115-154) are only partially decoded. The
    record does not appear to contain per-bin velocity profiles; those are
    likely in the separate .ADC files.

  - Navigation record (0x044e): Offset 26 is pitch (confirmed via ADCP
    cross-validation). Offset 42 is an unidentified float (mean ~-7,
    range ±23). Offset 24 is the altimeter max range config (constant 10),
    not actual altitude. Offset 30 is constant 90.0 (config parameter).
    Offset 38 is a byte-identical duplicate of the depth field at offset 34.

  - Sidescan record (0x03f7): No actual sonar imagery. Full-resolution
    sidescan data was logged separately and is not in this dataset.

  - ECO record (0x043e): Offset 45 is now decoded as Beta650 (1/m/sr).
    The chlorophyll proxy at offset 49 may be a derived value or a
    different channel than Chl-a.

  - GPS record (0x03f9): Internal structure beyond lat/lon is only
    partially decoded.

  - Nav/Acoustic record (0x041a): First 8 bytes and last 9 bytes
    (offsets 0-7 and 48-56) are undecoded.

  - Acoustic Nav Fix record (0x041f): The 74 bytes after the timestamp
    (offsets 52-125) are undecoded, possibly transponder response data.

  - Battery Cell Data record (0x0413): The scaling factor for the 7-cell
    ADC count readings (offsets 38-51) has not been determined.

  - Compass Calibration record (0x0415): Offsets 8, 12, 32, 36 are decoded
    but their physical meaning is uncertain (possibly raw magnetometer
    readings or motor-related metrics — they are highly correlated but do
    not correspond to heading values).

  - Energy Monitor record (0x0402): Behavior differs between missions.
    On 130906 it acts as a simple energy counter; on 130907 the capacity
    field cycles and energy goes negative.  Per-bank vs whole-vehicle
    interpretation is uncertain.

  - DVL Status (0x040b) and Subsystem Mode (0x0408): Internal structure
    only partially understood; logged as raw hex.

  - YSI CTD record (0x041d): The float at offset 20 has range 0.02-42
    with median ~4 when submerged, but does NOT correlate with nav depth
    (r = -0.07).  Its physical meaning is undetermined.

  - Checksum algorithm is not determined. The uint16 at header offset 2
    is believed to be a checksum but the specific algorithm (CRC16,
    Fletcher, sum, etc.) has not been determined.


8. FIELD CONFIDENCE SUMMARY
================================================================================

  Each decoded field is rated by the strength of evidence for its identity:

  HIGH   — Cross-validated against an independent source (ADCP data, .ini
           config, Seabird vs YSI CTD, haversine distances, UNESCO formula)
           or structurally self-evident (lat/lon, timestamps, ASCII strings).
  MEDIUM — Plausible interpretation based on value range and context, but
           not independently confirmed.
  LOW    — Speculative; value is decoded but physical meaning is uncertain.
  UNDECODED — Explicitly unknown; stored as raw or labeled "undecoded".

  Record Type                  HIGH   MED   LOW   UNDECODED   Total Fields
  ---------------------------  -----  ----  ----  ----------  ------------
  Navigation (0x044e)            7     0     0       1             8
  YSI CTD (0x041d)               6     0     0       1             7
  Seabird CTD (0x040a)           6     1     0       0             7
  ADCP/DVL (0x03e8)             12     2     3       0            17
  Sidescan (0x03f7)              4     1     0       0             5
  Wetlabs ECO BB2F (0x043e)      9     1     0       0            10
  GPS/Acoustic Nav (0x03f9)      2     1     0       0             3
  Nav/Acoustic (0x041a)          4     0     0       0             4
  Acoustic Nav Fix (0x041f)      5     1     0       0             6
  Battery Status (0x0412)        6     3     0       0             9
  Battery Cell Data (0x0413)     3     2     1       0             6
  Objective Navigation (0x03f1)  10    2     0       0            12
  Compass Calibration (0x0415)   5     2     4       0            11
  Housing Temperature (0x040e)   2     2     0       0             4
  Energy Monitor (0x0402)        1     2     1       0             4
  DVL Status (0x040b)            0     0     0       1             1
  Subsystem Mode (0x0408)        0     0     0       1             1
  Startup Flag (0x0446)          1     1     0       0             2
  Event Marker (0x03ef)          —     —     —       —             0
  ---------------------------  -----  ----  ----  ----------  ------------
  TOTAL                         ~93   ~21    ~9      ~4          ~127

  String/config records (Vehicle Name, Vehicle Info, Manufacturer Info,
  Diagnostic Log, Acoustic Modem Log, Mission Modes, Mission Legs, Sensor
  Names, Sensor Types, Sensor Display Config, Data Channels, Waypoints,
  ECO Calibration) are all HIGH confidence — their content is self-documenting
  ASCII text cross-referenced against .ini config files.

  Overall: ~73% HIGH, ~17% MEDIUM, ~7% LOW, ~3% UNDECODED.


9. FILE INVENTORY
================================================================================

  Path                                 Size      Records    Duration
  -----------------------------------  --------  ---------  --------
  130906/RLF/130906.RLF                34.9 MB   636,346    ~4.8 hrs
  130907/RLF/130907.RLF                35.2 MB   639,783    ~4.8 hrs
  130907/RLF/130907R.RLF                5.1 MB   (variant)  (reprocessed?)
  130908/RLF/130908.RLF                29.7 MB   538,455    ~4.0 hrs

  Companion files (not RLF format):
  ADCP/*.ADC     Raw ADCP ensemble data (~17 MB each)
  ADCP/*.GPS     GPS log
  ADCP/*.txt     ADCP text summary
  CONFIG/*.ini   Vehicle configuration (INI format, key source for decoding)
  CONFIG/*.rmf   Run Mission File (mission plan)
